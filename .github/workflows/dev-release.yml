name: DEV Release Automation

on:
  push:
    branches:
      - alpha
  workflow_dispatch:

jobs:
  manage-release:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Delete existing DEV releases
        env:
          GH_TOKEN: ${{ secrets.PERSONAL_TOKEN }}
        run: |
          releases=$(gh release list --limit 100 --json tagName,name --jq '.[] | select(.tagName == "DEV") | .name')
          for release in $releases; do
            echo "Deleting release: $release"
            gh release delete DEV --yes
          done

      - name: Create new DEV release
        env:
          GH_TOKEN: ${{ secrets.PERSONAL_TOKEN }}
        run: |
          timestamp=$(date +"%Y%m%d_%H%M%S")
          release_name="alpha_${timestamp}"
          echo "Creating release: $release_name"
          gh release create DEV --title "$release_name" --notes "Automatisch generiertes DEV Release vom $timestamp"
